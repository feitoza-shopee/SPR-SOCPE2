<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gestão de Veículos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: {
                        primary: { 50: '#eff6ff', 100: '#dbeafe', 500: '#3b82f6', 600: '#2563eb', 700: '#1d4ed8', 900: '#1e3a8a' }
                    }
                }
            }
        }
    </script>
    <style>
        .glass-effect { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .dark .glass-effect { background: rgba(17, 24, 39, 0.7); border: 1px solid rgba(255, 255, 255, 0.05); }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-5px); box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); }
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .loading { display: inline-block; width: 20px; height: 20px; border: 3px solid rgba(255,255,255,.3); border-radius: 50%; border-top-color: #fff; animation: spin 1s ease-in-out infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-300 font-sans">
    
    <!-- Loading Overlay -->
    <div id="loading-overlay" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center hidden">
        <div class="bg-white dark:bg-gray-800 p-8 rounded-2xl shadow-2xl text-center">
            <div class="loading mb-4 border-blue-500 border-t-transparent w-12 h-12"></div>
            <p class="text-gray-600 dark:text-gray-300 font-medium">Carregando dados...</p>
        </div>
    </div>

    <!-- Botão Dark Mode -->
    <button onclick="toggleDarkMode()" class="fixed top-4 right-4 z-50 p-3 rounded-full bg-white dark:bg-gray-800 shadow-lg border border-gray-200 dark:border-gray-700 hover:scale-110 transition-transform duration-200 group">
        <i class="fas fa-moon text-gray-600 dark:text-yellow-400 text-xl group-hover:rotate-12 transition-transform"></i>
    </button>

    <div class="flex h-screen overflow-hidden">
        <!-- Sidebar -->
        <aside class="w-64 bg-white dark:bg-gray-800 shadow-xl z-40 transition-all duration-300">
            <div class="p-6 border-b border-gray-200 dark:border-gray-700">
                <h1 class="text-2xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">
                    <i class="fas fa-truck-moving mr-2"></i>LogiTrack
                </h1>
                <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Sistema de Gestão</p>
            </div>
            <nav class="mt-6 px-4">
                <button onclick="showSection('dashboard')" id="nav-dashboard" class="w-full flex items-center px-4 py-3 mb-2 rounded-xl bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 font-medium transition-all hover:translate-x-2">
                    <i class="fas fa-chart-pie w-6"></i><span>Dashboard</span>
                </button>
                <button onclick="showSection('operacao')" id="nav-operacao" class="w-full flex items-center px-4 py-3 mb-2 rounded-xl text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700/50 font-medium transition-all hover:translate-x-2">
                    <i class="fas fa-table w-6"></i><span>Operação</span>
                </button>
            </nav>
            <div class="absolute bottom-0 w-full p-4 border-t border-gray-200 dark:border-gray-700">
                <div class="flex items-center px-4 py-2 text-sm text-gray-500 dark:text-gray-400">
                    <i class="fas fa-database mr-2"></i><span id="last-update">Carregando...</span>
                </div>
            </div>
        </aside>

        <main class="flex-1 overflow-y-auto bg-gray-50 dark:bg-gray-900 relative">
            <!-- Dashboard -->
            <section id="dashboard-section" class="p-8 fade-in">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-gray-800 dark:text-white mb-2">Dashboard</h2>
                    <p class="text-gray-600 dark:text-gray-400">Visão geral da operação</p>
                </div>

                <!-- Filtros -->
                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 mb-8 border border-gray-100 dark:border-gray-700">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-800 dark:text-white"><i class="fas fa-filter mr-2 text-blue-500"></i>Filtros</h3>
                        <button onclick="clearFilters()" class="text-sm text-blue-500 hover:text-blue-700 font-medium">Limpar Filtros</button>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Data</label>
                            <input type="date" id="filter-date" class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500" onchange="applyFilters()">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Turno</label>
                            <select id="filter-turno" class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500" onchange="applyFilters()">
                                <option value="">Todos</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Sortcode</label>
                            <select id="filter-sortcode" class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500" onchange="applyFilters()">
                                <option value="">Todos</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Status</label>
                            <select id="filter-status" class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500" onchange="applyFilters()">
                                <option value="">Todos</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl p-6 text-white shadow-lg card-hover relative overflow-hidden">
                        <div class="absolute top-0 right-0 -mt-4 -mr-4 w-24 h-24 bg-white opacity-10 rounded-full"></div>
                        <div class="flex items-center justify-between relative z-10">
                            <div>
                                <p class="text-blue-100 text-sm font-medium mb-1">Total de Veículos</p>
                                <h3 class="text-4xl font-bold" id="total-vehicles">0</h3>
                            </div>
                            <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center"><i class="fas fa-truck text-2xl"></i></div>
                        </div>
                    </div>
                    <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-2xl p-6 text-white shadow-lg card-hover relative overflow-hidden">
                        <div class="absolute top-0 right-0 -mt-4 -mr-4 w-24 h-24 bg-white opacity-10 rounded-full"></div>
                        <div class="flex items-center justify-between relative z-10">
                            <div>
                                <p class="text-green-100 text-sm font-medium mb-1">Concluídos</p>
                                <h3 class="text-4xl font-bold" id="status-concluido">0</h3>
                            </div>
                            <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center"><i class="fas fa-check-circle text-2xl"></i></div>
                        </div>
                    </div>
                    <div class="bg-gradient-to-br from-yellow-500 to-yellow-600 rounded-2xl p-6 text-white shadow-lg card-hover relative overflow-hidden">
                        <div class="absolute top-0 right-0 -mt-4 -mr-4 w-24 h-24 bg-white opacity-10 rounded-full"></div>
                        <div class="flex items-center justify-between relative z-10">
                            <div>
                                <p class="text-yellow-100 text-sm font-medium mb-1">Em Andamento</p>
                                <h3 class="text-4xl font-bold" id="status-andamento">0</h3>
                            </div>
                            <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center"><i class="fas fa-clock text-2xl"></i></div>
                        </div>
                    </div>
                    <div class="bg-gradient-to-br from-red-500 to-red-600 rounded-2xl p-6 text-white shadow-lg card-hover relative overflow-hidden">
                        <div class="absolute top-0 right-0 -mt-4 -mr-4 w-24 h-24 bg-white opacity-10 rounded-full"></div>
                        <div class="flex items-center justify-between relative z-10">
                            <div>
                                <p class="text-red-100 text-sm font-medium mb-1">Abaixo do Target</p>
                                <h3 class="text-4xl font-bold" id="below-target">0</h3>
                                <p class="text-red-100 text-xs mt-1">Orders < 5.776</p>
                            </div>
                            <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center"><i class="fas fa-exclamation-triangle text-2xl"></i></div>
                        </div>
                    </div>
                </div>

                <!-- Gráficos -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 border border-gray-100 dark:border-gray-700">
                        <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">Distribuição por Status</h3>
                        <canvas id="statusChart" height="300"></canvas>
                    </div>
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 border border-gray-100 dark:border-gray-700">
                        <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">Veículos por Turno</h3>
                        <canvas id="turnoChart" height="300"></canvas>
                    </div>
                </div>
            </section>

            <!-- Operação -->
            <section id="operacao-section" class="p-8 hidden fade-in">
                <div class="mb-8 flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                    <div>
                        <h2 class="text-3xl font-bold text-gray-800 dark:text-white mb-2">Operação</h2>
                        <p class="text-gray-600 dark:text-gray-400">Gestão detalhada das viagens</p>
                    </div>
                    <div class="relative w-full md:w-96">
                        <input type="text" id="search-trip" placeholder="Buscar por Trip Number..." 
                            class="w-full pl-12 pr-4 py-3 rounded-xl border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 shadow-lg"
                            onkeyup="searchTrip()">
                        <i class="fas fa-search absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                    </div>
                </div>

                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg overflow-hidden border border-gray-100 dark:border-gray-700">
                    <div class="overflow-x-auto">
                        <table class="w-full text-left border-collapse">
                            <thead>
                                <tr class="bg-gray-50 dark:bg-gray-700/50 border-b border-gray-200 dark:border-gray-700">
                                    <th class="px-6 py-4 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase">Trip Number</th>
                                    <th class="px-6 py-4 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase">Turno</th>
                                    <th class="px-6 py-4 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase">Status</th>
                                    <th class="px-6 py-4 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase">Tipo Veículo</th>
                                    <th class="px-6 py-4 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase">Sortcode</th>
                                    <th class="px-6 py-4 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase">CPT Realizado</th>
                                    <th class="px-6 py-4 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase">Orders</th>
                                    <th class="px-6 py-4 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase">Origem</th>
                                    <th class="px-6 py-4 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase">Justificativa</th>
                                </tr>
                            </thead>
                            <tbody id="table-body" class="divide-y divide-gray-200 dark:divide-gray-700"></tbody>
                        </table>
                    </div>
                    <div class="px-6 py-4 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-700/30 flex items-center justify-between">
                        <span class="text-sm text-gray-600 dark:text-gray-400" id="table-info">Carregando...</span>
                        <div class="flex gap-2">
                            <button onclick="previousPage()" class="px-3 py-1 rounded-lg bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-600 dark:text-gray-300 hover:bg-gray-50 disabled:opacity-50" id="btn-prev">Anterior</button>
                            <button onclick="nextPage()" class="px-3 py-1 rounded-lg bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-600 dark:text-gray-300 hover:bg-gray-50 disabled:opacity-50" id="btn-next">Próximo</button>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script>
        // CONFIGURAÇÃO - SUBSTITUA PELA SUA URL DO GOOGLE APPS SCRIPT DEPOIS
        const API_URL = 'https://script.google.com/macros/s/AKfycbxXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX/exec';
        
        let dados = [];
        let filteredData = [];
        let currentPage = 1;
        const itemsPerPage = 10;
        let statusChartInstance = null;
        let turnoChartInstance = null;

        // Dados mock para teste offline (funciona sem internet)
        function generateMockData() {
            const statuses = ['Concluído', 'Em Andamento', 'Pendente', 'Cancelado'];
            const turnos = ['Manhã', 'Tarde', 'Noite'];
            const vehicleTypes = ['Truck', 'Van', 'Carreta', 'VUC'];
            const sortcodes = ['SC001', 'SC002', 'SC003', 'SC004', 'SC005'];
            const sources = ['Hub SP', 'Hub RJ', 'Hub MG', 'Hub RS'];
            
            const data = [];
            for (let i = 1; i <= 150; i++) {
                data.push({
                    trip_number: `TRP${String(i).padStart(5, '0')}`,
                    turno: turnos[Math.floor(Math.random() * turnos.length)],
                    trip_status: statuses[Math.floor(Math.random() * statuses.length)],
                    vehicle_type_name: vehicleTypes[Math.floor(Math.random() * vehicleTypes.length)],
                    sortcode: sortcodes[Math.floor(Math.random() * sortcodes.length)],
                    cpt_realized: '2024-01-' + String(Math.floor(Math.random() * 28) + 1).padStart(2, '0') + ' ' + String(Math.floor(Math.random() * 24)).padStart(2, '0') + ':00',
                    orders: Math.floor(Math.random() * 8000) + 1000,
                    trip_source: sources[Math.floor(Math.random() * sources.length)],
                    justificativa: ''
                });
            }
            return data;
        }

        async function loadData() {
            const loading = document.getElementById('loading-overlay');
            loading.classList.remove('hidden');
            
            try {
                // Tenta carregar da API (quando configurar o Google Apps Script)
                const response = await fetch(API_URL);
                if (!response.ok) throw new Error('API não respondeu');
                
                const data = await response.json();
                
                // Mapeia os dados da planilha (ajuste os nomes das colunas conforme sua planilha)
                dados = data.map(row => ({
                    trip_number: row.trip_number || row.TripNumber || row['Trip Number'] || '',
                    turno: row.turno || row.Turno || '',
                    trip_status: row.trip_status || row.Status || row['Trip Status'] || '',
                    vehicle_type_name: row.vehicle_type_name || row.VehicleType || row['Vehicle Type'] || '',
                    sortcode: row.sortcode || row.Sortcode || '',
                    cpt_realized: row.cpt_realized || row.CPT || row['CPT Realized'] || '',
                    orders: parseInt(row.orders || row.Orders || 0),
                    trip_source: row.trip_source || row.Source || row['Trip Source'] || '',
                    justificativa: row.justificativa || row.Justificativa || ''
                })).filter(row => row.trip_number); // Remove linhas vazias

                document.getElementById('last-update').textContent = 'Dados ao vivo - ' + new Date().toLocaleTimeString();
                
            } catch (error) {
                console.log('Usando dados de demonstração:', error);
                dados = generateMockData();
                document.getElementById('last-update').textContent = 'Modo demonstração (offline)';
                document.getElementById('last-update').classList.add('text-yellow-500');
            }
            
            filteredData = [...dados];
            initializeFilters();
            applyFilters();
            renderTable();
            loading.classList.add('hidden');
        }

        function initializeFilters() {
            const turnos = [...new Set(dados.map(d => d.turno))].filter(Boolean).sort();
            const sortcodes = [...new Set(dados.map(d => d.sortcode))].filter(Boolean).sort();
            const statuses = [...new Set(dados.map(d => d.trip_status))].filter(Boolean).sort();

            // Preencher selects do dashboard
            const turnoSelect = document.getElementById('filter-turno');
            turnos.forEach(t => turnoSelect.innerHTML += `<option value="${t}">${t}</option>`);
            
            const sortcodeSelect = document.getElementById('filter-sortcode');
            sortcodes.forEach(s => sortcodeSelect.innerHTML += `<option value="${s}">${s}</option>`);
            
            const statusSelect = document.getElementById('filter-status');
            statuses.forEach(s => statusSelect.innerHTML += `<option value="${s}">${s}</option>`);
        }

        function toggleDarkMode() {
            document.documentElement.classList.toggle('dark');
            localStorage.setItem('darkMode', document.documentElement.classList.contains('dark'));
            updateCharts();
        }

        function showSection(section) {
            document.getElementById('dashboard-section').classList.add('hidden');
            document.getElementById('operacao-section').classList.add('hidden');
            document.getElementById('nav-dashboard').className = 'w-full flex items-center px-4 py-3 mb-2 rounded-xl text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700/50 font-medium transition-all hover:translate-x-2';
            document.getElementById('nav-operacao').className = 'w-full flex items-center px-4 py-3 mb-2 rounded-xl text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700/50 font-medium transition-all hover:translate-x-2';
            
            document.getElementById(section + '-section').classList.remove('hidden');
            document.getElementById('nav-' + section).className = 'w-full flex items-center px-4 py-3 mb-2 rounded-xl bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 font-medium transition-all hover:translate-x-2';
            
            if (section === 'dashboard') setTimeout(updateCharts, 100);
        }

        function applyFilters() {
            const date = document.getElementById('filter-date').value;
            const turno = document.getElementById('filter-turno').value;
            const sortcode = document.getElementById('filter-sortcode').value;
            const status = document.getElementById('filter-status').value;

            filteredData = dados.filter(item => {
                const itemDate = item.cpt_realized ? item.cpt_realized.split(' ')[0] : '';
                return (!date || itemDate === date) &&
                       (!turno || item.turno === turno) &&
                       (!sortcode || item.sortcode === sortcode) &&
                       (!status || item.trip_status === status);
            });

            updateDashboard();
            currentPage = 1;
            renderTable();
        }

        function clearFilters() {
            document.getElementById('filter-date').value = '';
            document.getElementById('filter-turno').value = '';
            document.getElementById('filter-sortcode').value = '';
            document.getElementById('filter-status').value = '';
            applyFilters();
        }

        function updateDashboard() {
            const uniqueTrips = new Set(filteredData.map(d => d.trip_number));
            document.getElementById('total-vehicles').textContent = uniqueTrips.size;

            const statusCounts = {};
            filteredData.forEach(d => statusCounts[d.trip_status] = (statusCounts[d.trip_status] || 0) + 1);
            
            document.getElementById('status-concluido').textContent = statusCounts['Concluído'] || 0;
            document.getElementById('status-andamento').textContent = statusCounts['Em Andamento'] || 0;
            document.getElementById('below-target').textContent = filteredData.filter(d => d.orders < 5776).length;

            updateCharts();
        }

        function updateCharts() {
            const isDark = document.documentElement.classList.contains('dark');
            const textColor = isDark ? '#9ca3af' : '#4b5563';
            
            const statusCounts = {}, turnoCounts = {};
            filteredData.forEach(d => {
                statusCounts[d.trip_status] = (statusCounts[d.trip_status] || 0) + 1;
                turnoCounts[d.turno] = (turnoCounts[d.turno] || 0) + 1;
            });

            if (statusChartInstance) statusChartInstance.destroy();
            statusChartInstance = new Chart(document.getElementById('statusChart'), {
                type: 'doughnut',
                data: {
                    labels: Object.keys(statusCounts),
                    datasets: [{ data: Object.values(statusCounts), backgroundColor: ['#10b981', '#3b82f6', '#f59e0b', '#ef4444'], borderWidth: 0 }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom', labels: { color: textColor } } } }
            });

            if (turnoChartInstance) turnoChartInstance.destroy();
            turnoChartInstance = new Chart(document.getElementById('turnoChart'), {
                type: 'bar',
                data: {
                    labels: Object.keys(turnoCounts),
                    datasets: [{ data: Object.values(turnoCounts), backgroundColor: ['#8b5cf6', '#ec4899', '#06b6d4'], borderRadius: 8 }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { beginAtZero: true, ticks: { color: textColor }, grid: { color: isDark ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)' } },
                        x: { ticks: { color: textColor }, grid: { display: false } }
                    }
                }
            });
        }

        function renderTable() {
            const search = document.getElementById('search-trip').value.toLowerCase();
            let tableData = filteredData.filter(item => !search || item.trip_number.toLowerCase().includes(search));
            
            const totalPages = Math.ceil(tableData.length / itemsPerPage);
            const start = (currentPage - 1) * itemsPerPage;
            const pageData = tableData.slice(start, start + itemsPerPage);

            const tbody = document.getElementById('table-body');
            tbody.innerHTML = '';

            pageData.forEach(item => {
                const statusColors = {
                    'Concluído': 'bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400',
                    'Em Andamento': 'bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400',
                    'Pendente': 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400',
                    'Cancelado': 'bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400'
                };
                
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors';
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white">${item.trip_number}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600 dark:text-gray-400">${item.turno}</td>
                    <td class="px-6 py-4 whitespace-nowrap"><span class="px-3 py-1 rounded-full text-xs font-medium ${statusColors[item.trip_status] || 'bg-gray-100'}">${item.trip_status}</span></td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600 dark:text-gray-400">${item.vehicle_type_name}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600 dark:text-gray-400">${item.sortcode}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600 dark:text-gray-400">${item.cpt_realized}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm ${item.orders < 5776 ? 'text-red-600 dark:text-red-400 font-bold' : 'text-gray-900 dark:text-gray-100'}">${item.orders.toLocaleString()}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600 dark:text-gray-400">${item.trip_source}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <select onchange="updateJustificativa('${item.trip_number}', this.value)" class="text-sm rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white px-3 py-1 focus:ring-2 focus:ring-blue-500">
                            <option value="">Selecione...</option>
                            <option value="Falta de pacotes" ${item.justificativa === 'Falta de pacotes' ? 'selected' : ''}>Falta de pacotes</option>
                            <option value="Perfil volumoso" ${item.justificativa === 'Perfil volumoso' ? 'selected' : ''}>Perfil volumoso</option>
                            <option value="Falta de HC" ${item.justificativa === 'Falta de HC' ? 'selected' : ''}>Falta de HC</option>
                        </select>
                    </td>
                `;
                tbody.appendChild(row);
            });

            document.getElementById('table-info').textContent = `Mostrando ${Math.min(tableData.length, start + 1)}-${Math.min(tableData.length, start + itemsPerPage)} de ${tableData.length} registros`;
            document.getElementById('btn-prev').disabled = currentPage === 1;
            document.getElementById('btn-next').disabled = currentPage >= totalPages;
        }

        function updateJustificativa(tripNumber, value) {
            const item = dados.find(d => d.trip_number === tripNumber);
            if (item) item.justificativa = value;
            console.log('Justificativa atualizada:', tripNumber, value);
        }

        function searchTrip() { currentPage = 1; renderTable(); }
        function previousPage() { if (currentPage > 1) { currentPage--; renderTable(); } }
        function nextPage() { currentPage++; renderTable(); }

        // Inicialização
        document.addEventListener('DOMContentLoaded', () => {
            if (localStorage.getItem('darkMode') === 'true') document.documentElement.classList.add('dark');
            loadData();
        });
    </script>
</body>
</html>